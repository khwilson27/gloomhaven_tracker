<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
</head>
<body>

    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">
                    <span id="logo-span">
                            <img src="assets/img/favicon/ckev_favicon.jpg" alt="cKEV logo" id="navbar-logo" height="20">
                    </span><span id="brand-name">Gloomhaven Tracker</span>
                </a>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li class='navlink'><a id='player_ref_nav' href='#' class="trigger_modal_info" data-toggle="modal" data-target="#modal_info" data-action="short_guide">Short Guide</a></li>
                <li class='navlink'><a id='player_ref_nav' href='#' class="trigger_modal_info" data-toggle="modal" data-target="#modal_info" data-action="long_guide">Long Guide</a></li>
                <li class='navlink'><a id='logout_nav' href='#'>Logout</a></li>
            </ul>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-6">

                <div class="panel panel-default">
                    <!-- Default panel contents -->
                    <div class="panel-heading centered-text"><a class="trigger_modal_info" data-action="show_char_card" href='#' id="character_class" data-toggle="modal" data-target="#modal_info">Character Class</a></div>
                    
                    <!-- Table -->
                    <table class="table table-sm table-bordered">
                        <tbody>
                            <!-- <tr>
                                <th width='25%' scope="row">Party:</th>
                                <td width='75%'><a href='#' id="party_name" class="trigger_modal_edit" data-action="edit_party" data-toggle="modal" data-target="#modal_edit">Add your Party</a></td>
                            </tr> -->
                            <tr>
                                <th width='25%' scope="row">Name:</th>
                                <td width='75%'><a href='#' id="character_name" class="trigger_modal_edit" data-action="edit_name" data-toggle="modal" data-target="#modal_edit">Character Name</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                    

                <table class="table table-sm table-bordered">
                    <tbody>
                        <tr>
                            <th width='10%' scope="row">Lvl</th>
                            <td width='10%' class="xp_lvl_1">1</td>
                            <td width='10%' class="xp_lvl_2">2</td>
                            <td width='10%' class="xp_lvl_3">3</td>
                            <td width='10%' class="xp_lvl_4">4</td>
                            <td width='10%' class="xp_lvl_5">5</td>
                            <td width='10%' class="xp_lvl_6">6</td>
                            <td width='10%' class="xp_lvl_7">7</td>
                            <td width='10%' class="xp_lvl_8">8</td>
                            <td width='10%' class="xp_lvl_9">9</td>
                        </tr>
                        <tr>
                            <th width='10%' scope="row">Exp</th>
                            <td width='10%' class="xp_lvl_1">0</td>
                            <td width='10%' class="xp_lvl_2">45</td>
                            <td width='10%' class="xp_lvl_3">95</td>
                            <td width='10%' class="xp_lvl_4">150</td>
                            <td width='10%' class="xp_lvl_5">210</td>
                            <td width='10%' class="xp_lvl_6">275</td>
                            <td width='10%' class="xp_lvl_7">345</td>
                            <td width='10%' class="xp_lvl_8">420</td>
                            <td width='10%' class="xp_lvl_9">500</td>
                        </tr>
                    </tbody>
                </table>

                <table class="table table-sm table-bordered">
                    <tbody>
                        <tr>
                            <td width='16.66%'>XP:</td>
                            <td width='16.66%'><a href='#' id="character_xp" class="trigger_modal_edit" data-action="edit_xp" data-toggle="modal" data-target="#modal_edit">#</a></td>
                            <td width='16.66%'>Gold:</td>
                            <td width='16.66%'><a href='#' id="character_gold" class="trigger_modal_edit" data-action="edit_gold" data-toggle="modal" data-target="#modal_edit">#</a></td>
                            <td width='16.66%'>Notes:</td>
                            <td width='16.66%'><a href='#' id="character_notes" class="trigger_modal_edit" data-action="edit_notes" data-toggle="modal" data-target="#modal_edit">#</a></td>
                        </tr>
                    </tbody>
                </table>

                <div class="panel panel-default">
                    <div class="panel-heading">Notes</div>
                        <div class="panel-body">
                            <p style='float:left; padding-right: 4px;'>1:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_1">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_2">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_3">
                            </div>
    
                            <p style='float:left; padding-right: 4px;'>2:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_4">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_5">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_6">
                            </div>
    
                            <p style='float:left; padding-right: 4px;'>3:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_7">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_8">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_9">
                            </div>
    
                            <p style='float:left; padding-right: 4px;'>4:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_10">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_11">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_12">
                            </div>
    
                            <p style='float:left; padding-right: 4px;'>5:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_13">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_14"> 
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_15"> 
                            </div>
    
                            <p style='float:left; padding-right: 4px;'>6:</p>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_16">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_17">
                            </div>
                            <div class="form-check" style='float:left; padding-right: 4px;'>
                                <input class="form-check-input position-static" type="checkbox" value="option1" aria-label="..." id="character_note_18">
                            </div>
                        </div>
                </div>

                <!-- <div class="panel panel-default">
                    <div class="panel-heading">Items</div>
                    <div class="panel-body">
                        <ul id="character_item_list">
                            <li><a href='#'>Leather Armor</a></li>
                            <li><a href='#'>Minor Stamina Potion</a></li>
                        </ul>

                        <button type="button" class="btn btn-info" id='add_item_btn' data-toggle="modal" data-target="#modal_edit">Add Item</button>

                    </div>
                </div> -->
            </div>

            <div class="col-md-6">
                
                <div class="panel panel-default">
                    <div class="panel-heading">Perks</div>
                    <div class="panel-body">
                        <table class="table table-sm table-bordered">
                            <thead>
                              <tr>
                                <th scope="col">Current</th>
                                <th scope="col">Required</th>
                                <th scope="col">Learned</th>
                                <th scope="col">Effect</th>
                              </tr>
                            </thead>
                            <tbody id="perks_table"></tbody>
                          </table>
                    </div>
                </div>

            </div>

        </div>

        <!-- BEGIN DETAILS MODAL -->
        <div id="modal_info" class="modal fade" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" id="detail-title">Info</h4>
                    </div>
                    <div class="modal-body" id="modal_info_body"></div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-round btn-fill" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="modal_edit" class="modal fade" role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title" id="edit_title">Edit: #</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="edit_value" id="edit_label">Edit Value</label>
                            <input type="text" class="form-control" id="edit_form" placeholder="John the Brute">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-round btn-fill" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-success btn-round btn-fill" id="update_button">Update</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- END DETAILS MODAL -->

    </div>

<script src="js/character_classes.js"></script> <!-- character class object defined here -->
<script type="text/javascript">
    var global = {};
    var playerClass = null;

    $(document).ready(function() {
        if (!localStorage.getItem('token')) {
            window.location.href = "/register"
        }
        else {
            var renderHome = function() {
                $.ajax({
                    url: "/api/characterinfo",
                    type: 'GET',
                    // Fetch the stored token from localStorage and set in the header
                    headers: {
                        "Authorization": localStorage.getItem('token')
                    },
                    success: function(data) {

                        global.char_data = data;
                        console.log(global);
                        console.log(data);

                        //-------------------------------------------
                        //Plug all of user's values into the UI
                        //-------------------------------------------
                        //Class
                        // 01 - Brute
                        // 02 - Tinkerer
                        // 03 - Spellweaver
                        // 04 - Scoundrel
                        // 05 - Cragheart
                        // 06 - Mindthief

                        // Character name, xp, gold, and notes
                        $("#character_name").text(data.name);
                        $("#character_xp").text(data.xp);
                        $("#character_gold").text(data.gold);
                        $("#character_notes").text(data.notes);

                        // Check boxes for notes and disable
                        $(":checkbox").prop("checked", false).on("click", false);
                        for (var i = 1; i < Number(data.notes) + 1; i++) {
                            var char_note_string = "#character_note_" + i;
                            $(char_note_string).prop("checked", "true");
                            if (i >= 19) break;
                        }

                        // Determine level and highlight correct character level and xp
                        var lvl = 1;
                        if (data.xp >= 500) {
                            lvl = 9 
                        } else if (data.xp >= 420) {
                            lvl = 8
                        } else if (data.xp >= 345) {
                            lvl = 7
                        } else if (data.xp >= 275) {
                            lvl = 6
                        } else if (data.xp >= 210) {
                            lvl = 5
                        } else if (data.xp >= 150) {
                            lvl = 4
                        } else if (data.xp >= 95) {
                            lvl = 3
                        } else if (data.xp >= 45) {
                            lvl = 2
                        }
                        var target_to_hightlight = ".xp_lvl_" + lvl;
                        $(target_to_hightlight).attr("style", "background-color:rgba(76, 175, 80, 0.3)");

                        // Character class info
                        playerClass = character_classes[data.class_id.toString()];
                        $("#character_class").text(playerClass.name);

                        // Render perks list
                        $("#perks_table").empty();
                        for (var i = 0; i < playerClass.perks.length; i++) {
                            var indexPlus1 = i+1;
                            var currentkey = "perk_" + indexPlus1;
                            var current_perk = data[currentkey] ? data[currentkey] : 0;
                            var learned = (current_perk >= playerClass.perks[i].checkboxQuantity) ? "X" : "";

                            var $tablerow = $("<tr>").appendTo($("#perks_table"));

                            var $td1 = $("<td>").appendTo($tablerow);
                            var $a = $("<a>", {"data-action": "edit_perk_" + indexPlus1, "data-toggle": "modal", "data-target": "#modal_edit"}).html(current_perk).appendTo($td1);

                            var $td2 = $("<td>").text(playerClass.perks[i].checkboxQuantity).appendTo($tablerow);
                            var $td3 = $("<td>").text(learned).appendTo($tablerow);
                            var $td4 = $("<td>").text(playerClass.perks[i].text).appendTo($tablerow);
                        }
                    }
                })
            }

            renderHome();
                        
            $(".trigger_modal_info").on("click", function() {
                $("#modal_info_body").empty();

                var action = $(this).data("action");
                switch (action) {
                    case "short_guide":
                        var $embed = $("<embed>", {src: "assets/pdf/guides/one_sheet_v2.pdf", width: "100%", height: "600px"});
                        $("#modal_info_body").append($embed);
                        break;
                    case "long_guide":
                        var $embed = $("<embed>", {src: "assets/pdf/guides/rules_summary.pdf", width: "100%", height: "600px"});
                        $("#modal_info_body").append($embed);
                        break;
                    case "show_char_card":
                        var $img = $("<img>", {src: playerClass.mat, width: "100%"});
                        $("#modal_info_body").append($img);
                        break;
                    default:
                        break;
                }
            })

            $(".trigger_modal_edit").on("click", function() {
                console.log("clicked modal trigger");
            })

            // allows user to sign out...deletes token and redirects to login
            $("#logout_nav").on("click", function (event) {
                event.preventDefault();

                window.localStorage.removeItem("token");
                window.location.href = "/register";
                alert("Logging out...")
            });
        }
    })
</script>

    
</body>
</html>